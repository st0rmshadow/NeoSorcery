#!/usr/bin/env zsh
DEFAULTS_FILE="$HOME/.sorcery/spell.defaults"
# Resolve grimoire paths
if [[ "$1" == "-h" || "$1" == "--help" || "$1" == "help" ]]; then
  echo "Usage: gaze [spell]"
  echo "Options:"
  echo "  -h, --help     Show this help message and exit"
  exit 0
fi

if [[ -z "$1" ]]; then
  echo "Installed packages:"
  ls var/installed | sed 's/.manifest$//'
else
  MANIFEST="var/installed/$1.manifest"
  [[ ! -f "$MANIFEST" ]] && echo "No manifest found for $1" && exit 1
  echo "Source:"
  grep "^$1=" "$DEFAULTS_FILE" 2>/dev/null || echo "unknown"
  echo ""
  cat "$MANIFEST"
fi


echo ""
VERSIONS_FILE="$HOME/.sorcery/spell.versions"
if [[ -f "$VERSIONS_FILE" ]]; then
  grep "^$1:" "$VERSIONS_FILE"
fi
